:py:mod:`neural_compressor.compression.pruner.model_slim.pattern_analyzer`
==========================================================================

.. py:module:: neural_compressor.compression.pruner.model_slim.pattern_analyzer

.. autoapi-nested-parse::

   Analyze.



Module Contents
---------------

Classes
~~~~~~~

.. autoapisummary::

   neural_compressor.compression.pruner.model_slim.pattern_analyzer.RecipeSearcher
   neural_compressor.compression.pruner.model_slim.pattern_analyzer.JitBasicSearcher
   neural_compressor.compression.pruner.model_slim.pattern_analyzer.PathSearcher
   neural_compressor.compression.pruner.model_slim.pattern_analyzer.Linear2LinearSearcher
   neural_compressor.compression.pruner.model_slim.pattern_analyzer.SelfMHASearcher



Functions
~~~~~~~~~

.. autoapisummary::

   neural_compressor.compression.pruner.model_slim.pattern_analyzer.get_attributes



.. py:function:: get_attributes(module: torch.nn.Module, attrs: str)

   Get a multi-level descent module of module.

   :param module: The torch module.
   :type module: torch.nn.Module
   :param attrs: The attributes' calling path.
   :type attrs: str

   :returns: The target attribute of the module.
   :rtype: attr


.. py:class:: RecipeSearcher(model: torch.nn.Module, recipe: dict)



   Searcher class which searches patterns with a pre-defined recipe.

   A Recipe is a dict type data which contains the root module's name and
   its sub-modules' levelwise calling way.
   For example, for the self-attention module in Huggingface bert-model,
   if we want to obtain its linear ops (query, key, value and output),
   the recipe should be like:
   recipe_samples = {
       'BertAttention': ["self.query", "self.key", "self.value", "output.dense"]
   }

   :param model: The PyTorch model for searching.
   :type model: torch.nn.Module
   :param recipe: A dict containing infomation of the searching pattern.
   :type recipe: dict

   .. attribute:: model

      The PyTorch model for searching.

   .. attribute:: recipe

      A dict containing infomation of the searching pattern.

   .. attribute:: targets

      The basic module's name which contains searching pattern.

   .. attribute:: searching_results

      The list/dict which store matched patterns.


.. py:class:: JitBasicSearcher(model)



   Static graph searcher class which searches patterns with PyTorch static graph and its input/output information.

   By converting a PyTorch Model into a static version using torch.jit.trace()/script(),
   we can trace some special pattern in the model and optimize them automatically.
   This class provide some basic functions for jit searcher
   Including generating dummy inputs, generating static graph, analyzing static graph.

   :param model: The PyTorch model for searching.
   :type model: torch.nn.Module

   .. attribute:: model

      The PyTorch model for searching.

   .. attribute:: device

      The model's current device type.

   .. attribute:: static_graph

      The static graph of original model.

   .. attribute:: flatten_static_graph

      A list of string with the model's static graph inference details.

   .. attribute:: target_layers

      The layer types the searcher will extract.

   .. attribute:: searching_results

      The list/dict which store matched patterns.


.. py:class:: PathSearcher(model, target_pattern='linear/gelu/linear')



   Static graph searcher.

   Use the static graph to detect some special pattern in a module, there is no need for user to define layer name.
   Need to provide a string to indicate the structure/sequence of the target pattern.

   :param model: The PyTorch model for searching.
   :type model: torch.nn.Module
   :param target_pattern: a string presenting the pattern to search (use '/' to link different layer names.)
   :type target_pattern: str

   .. attribute:: model

      The PyTorch model for searching.

   .. attribute:: device

      The model's current device type.

   .. attribute:: static_graph

      The static graph of original model.

   .. attribute:: flatten_static_graph

      A list of string with the model's static graph inference details.

   .. attribute:: target_layers

      The layer types the searcher will extract.

   .. attribute:: searching_results

      The list/dict which store matched patterns.

   .. attribute:: target_path

      a string presenting the pattern to search (use '/' to link different layer names.)

   .. attribute:: target_op

      a set containing target operators' names.

   .. attribute:: target_op_lut

      a lookup table for target operators and their corresponding jit codes.

   .. attribute:: current_pattern

      a searching path to store searching status.


.. py:class:: Linear2LinearSearcher(model)



   Static graph searcher for consecutive linear layers.

   Use the static graph to detect some special pattern in a module, there is no need for user to define layer name.
   Automatically search linear layers which can be optimized.

   :param model: The PyTorch model for searching.
   :type model: torch.nn.Module

   .. attribute:: model

      The PyTorch model for searching.

   .. attribute:: device

      The model's current device type.

   .. attribute:: static_graph

      The static graph of original model.

   .. attribute:: flatten_static_graph

      A list of string with the model's static graph inference details.

   .. attribute:: target_layers

      The layer types the searcher will extract.

   .. attribute:: searching_results

      The list/dict which store matched patterns.

   .. attribute:: target_op_lut

      a lookup table for target operators and their corresponding jit codes.

   .. attribute:: current_pattern

      a searching path to store searching status.


.. py:class:: SelfMHASearcher(model)



   Static graph searcher for multi-head attention modules.

   Use the static graph to detect some special pattern in a module, there is no need for user to define layer name.
   Automatically search multi-head attention modules which can be optimized.

   :param model: The PyTorch model for searching.
   :type model: torch.nn.Module

   .. attribute:: model

      The PyTorch model for searching.

   .. attribute:: device

      The model's current device type.

   .. attribute:: static_graph

      The static graph of original model.

   .. attribute:: flatten_static_graph

      A list of string with the model's static graph inference details.


